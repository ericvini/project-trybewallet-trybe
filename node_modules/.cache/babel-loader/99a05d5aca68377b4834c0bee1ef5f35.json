{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Explorer = void 0;\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _ExplorerBase = require(\"./ExplorerBase\");\n\nvar _readFile = require(\"./readFile\");\n\nvar _cacheWrapper = require(\"./cacheWrapper\");\n\nvar _getDirectory = require(\"./getDirectory\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nclass Explorer extends _ExplorerBase.ExplorerBase {\n  constructor(options) {\n    super(options);\n  }\n\n  async search(searchFrom = process.cwd()) {\n    const startDirectory = await (0, _getDirectory.getDirectory)(searchFrom);\n    const result = await this.searchFromDirectory(startDirectory);\n    return result;\n  }\n\n  async searchFromDirectory(dir) {\n    const absoluteDir = _path.default.resolve(process.cwd(), dir);\n\n    const run = async () => {\n      const result = await this.searchDirectory(absoluteDir);\n      const nextDir = this.nextDirectoryToSearch(absoluteDir, result);\n\n      if (nextDir) {\n        return this.searchFromDirectory(nextDir);\n      }\n\n      const transformResult = await this.config.transform(result);\n      return transformResult;\n    };\n\n    if (this.searchCache) {\n      return (0, _cacheWrapper.cacheWrapper)(this.searchCache, absoluteDir, run);\n    }\n\n    return run();\n  }\n\n  async searchDirectory(dir) {\n    for await (const place of this.config.searchPlaces) {\n      const placeResult = await this.loadSearchPlace(dir, place);\n\n      if (this.shouldSearchStopWithResult(placeResult) === true) {\n        return placeResult;\n      }\n    } // config not found\n\n\n    return null;\n  }\n\n  async loadSearchPlace(dir, place) {\n    const filepath = _path.default.join(dir, place);\n\n    const fileContents = await (0, _readFile.readFile)(filepath);\n    const result = await this.createCosmiconfigResult(filepath, fileContents);\n    return result;\n  }\n\n  async loadFileContent(filepath, content) {\n    if (content === null) {\n      return null;\n    }\n\n    if (content.trim() === '') {\n      return undefined;\n    }\n\n    const loader = this.getLoaderEntryForFile(filepath);\n    const loaderResult = await loader(filepath, content);\n    return loaderResult;\n  }\n\n  async createCosmiconfigResult(filepath, content) {\n    const fileContent = await this.loadFileContent(filepath, content);\n    const result = this.loadedContentToCosmiconfigResult(filepath, fileContent);\n    return result;\n  }\n\n  async load(filepath) {\n    this.validateFilePath(filepath);\n\n    const absoluteFilePath = _path.default.resolve(process.cwd(), filepath);\n\n    const runLoad = async () => {\n      const fileContents = await (0, _readFile.readFile)(absoluteFilePath, {\n        throwNotFound: true\n      });\n      const result = await this.createCosmiconfigResult(absoluteFilePath, fileContents);\n      const transformResult = await this.config.transform(result);\n      return transformResult;\n    };\n\n    if (this.loadCache) {\n      return (0, _cacheWrapper.cacheWrapper)(this.loadCache, absoluteFilePath, runLoad);\n    }\n\n    return runLoad();\n  }\n\n}\n\nexports.Explorer = Explorer;","map":{"version":3,"sources":["../src/Explorer.ts"],"names":["ExplorerBase","constructor","searchFrom","process","startDirectory","result","absoluteDir","path","run","nextDir","transformResult","placeResult","filepath","fileContents","content","loader","loaderResult","fileContent","absoluteFilePath","runLoad","throwNotFound"],"mappings":"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","sourcesContent":["import path from 'path';\nimport { ExplorerBase } from './ExplorerBase';\nimport { readFile } from './readFile';\nimport { cacheWrapper } from './cacheWrapper';\nimport { getDirectory } from './getDirectory';\nimport { CosmiconfigResult, ExplorerOptions, LoadedFileContent } from './types';\n\nclass Explorer extends ExplorerBase<ExplorerOptions> {\n  public constructor(options: ExplorerOptions) {\n    super(options);\n  }\n\n  public async search(\n    searchFrom: string = process.cwd(),\n  ): Promise<CosmiconfigResult> {\n    const startDirectory = await getDirectory(searchFrom);\n    const result = await this.searchFromDirectory(startDirectory);\n\n    return result;\n  }\n\n  private async searchFromDirectory(dir: string): Promise<CosmiconfigResult> {\n    const absoluteDir = path.resolve(process.cwd(), dir);\n\n    const run = async (): Promise<CosmiconfigResult> => {\n      const result = await this.searchDirectory(absoluteDir);\n      const nextDir = this.nextDirectoryToSearch(absoluteDir, result);\n\n      if (nextDir) {\n        return this.searchFromDirectory(nextDir);\n      }\n\n      const transformResult = await this.config.transform(result);\n\n      return transformResult;\n    };\n\n    if (this.searchCache) {\n      return cacheWrapper(this.searchCache, absoluteDir, run);\n    }\n\n    return run();\n  }\n\n  private async searchDirectory(dir: string): Promise<CosmiconfigResult> {\n    for await (const place of this.config.searchPlaces) {\n      const placeResult = await this.loadSearchPlace(dir, place);\n\n      if (this.shouldSearchStopWithResult(placeResult) === true) {\n        return placeResult;\n      }\n    }\n\n    // config not found\n    return null;\n  }\n\n  private async loadSearchPlace(\n    dir: string,\n    place: string,\n  ): Promise<CosmiconfigResult> {\n    const filepath = path.join(dir, place);\n    const fileContents = await readFile(filepath);\n\n    const result = await this.createCosmiconfigResult(filepath, fileContents);\n\n    return result;\n  }\n\n  private async loadFileContent(\n    filepath: string,\n    content: string | null,\n  ): Promise<LoadedFileContent> {\n    if (content === null) {\n      return null;\n    }\n    if (content.trim() === '') {\n      return undefined;\n    }\n    const loader = this.getLoaderEntryForFile(filepath);\n    const loaderResult = await loader(filepath, content);\n    return loaderResult;\n  }\n\n  private async createCosmiconfigResult(\n    filepath: string,\n    content: string | null,\n  ): Promise<CosmiconfigResult> {\n    const fileContent = await this.loadFileContent(filepath, content);\n    const result = this.loadedContentToCosmiconfigResult(filepath, fileContent);\n\n    return result;\n  }\n\n  public async load(filepath: string): Promise<CosmiconfigResult> {\n    this.validateFilePath(filepath);\n    const absoluteFilePath = path.resolve(process.cwd(), filepath);\n\n    const runLoad = async (): Promise<CosmiconfigResult> => {\n      const fileContents = await readFile(absoluteFilePath, {\n        throwNotFound: true,\n      });\n\n      const result = await this.createCosmiconfigResult(\n        absoluteFilePath,\n        fileContents,\n      );\n\n      const transformResult = await this.config.transform(result);\n\n      return transformResult;\n    };\n\n    if (this.loadCache) {\n      return cacheWrapper(this.loadCache, absoluteFilePath, runLoad);\n    }\n\n    return runLoad();\n  }\n}\n\nexport { Explorer };\n"]},"metadata":{},"sourceType":"script"}